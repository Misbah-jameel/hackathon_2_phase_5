# OKE (Oracle Kubernetes Engine) - Always Free ARM tier
# Usage: helm install todo-backend helm/backend/ -f helm/backend/values-oke.yaml -n todo-app

replicaCount: 1

image:
  repository: <REGION>.ocir.io/<TENANCY_NAMESPACE>/todo-backend
  tag: latest
  pullPolicy: IfNotPresent

imagePullSecrets:
  - name: ocir-secret

service:
  type: ClusterIP
  port: 8000
  targetPort: 8000

# Dapr sidecar configuration
dapr:
  enabled: true
  appId: todo-backend
  appPort: 8000

env:
  DATABASE_URL: ""  # Set via todo-secrets K8s secret (Neon PostgreSQL)
  JWT_SECRET: ""    # Set via todo-secrets K8s secret
  JWT_ALGORITHM: "HS256"
  JWT_EXPIRY_HOURS: "24"
  CORS_ORIGINS: ""  # Set after LB IP is known
  ANTHROPIC_API_KEY: ""  # Set via todo-secrets K8s secret
  ANTHROPIC_MODEL: "claude-3-haiku-20240307"
  DAPR_HOST: "localhost"
  DAPR_PORT: "3500"
  DAPR_PUBSUB_NAME: "pubsub"

# ARM-optimized probes: longer initial delays for slower ARM cold starts
probes:
  liveness:
    path: /health
    port: 8000
    initialDelaySeconds: 60
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 5
  readiness:
    path: /health
    port: 8000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 10
    failureThreshold: 5

# ARM-optimized resource limits (4 OCPU / 24GB shared)
resources:
  requests:
    cpu: 200m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi
